
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../glossary/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Docs - rules_synology</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="rules_synology" class="md-header__button md-logo" aria-label="rules_synology" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            rules_synology
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docs
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="rules_synology" class="md-nav__button md-logo" aria-label="rules_synology" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    rules_synology
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Reference Documentation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Docs
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    Rules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data_share" class="md-nav__link">
    data_share
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker_project" class="md-nav__link">
    docker_project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-collection-of-docker-projects" class="md-nav__link">
    Configure a collection of Docker Projects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image" class="md-nav__link">
    image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#images" class="md-nav__link">
    images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#info_file" class="md-nav__link">
    info_file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-an-info-file" class="md-nav__link">
    Create an INFO file
  </a>
  
    <nav class="md-nav" aria-label="Create an INFO file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maintainer" class="md-nav__link">
    maintainer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privilege_config" class="md-nav__link">
    privilege_config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protocol_file" class="md-nav__link">
    protocol_file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource_config" class="md-nav__link">
    resource_config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service_config" class="md-nav__link">
    service_config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd_user_unit" class="md-nav__link">
    systemd_user_unit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-usrlocal-linker" class="md-nav__link">
    Configure a /usr/local Linker
  </a>
  
    <nav class="md-nav" aria-label="Configure a /usr/local Linker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usr_local_linker" class="md-nav__link">
    usr_local_linker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-usrlocal-linker_1" class="md-nav__link">
    Configure a /usr/local Linker
  </a>
  
    <nav class="md-nav" aria-label="Configure a /usr/local Linker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#confirm_binary_matches_platform" class="md-nav__link">
    confirm_binary_matches_platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker_compose" class="md-nav__link">
    docker_compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-single-docker-project-a-docker-compose" class="md-nav__link">
    Configure a single Docker Project (a docker-compose)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spk_component" class="md-nav__link">
    spk_component
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rules" class="md-nav__link">
    Rules
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data_share" class="md-nav__link">
    data_share
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker_project" class="md-nav__link">
    docker_project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-collection-of-docker-projects" class="md-nav__link">
    Configure a collection of Docker Projects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image" class="md-nav__link">
    image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#images" class="md-nav__link">
    images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#info_file" class="md-nav__link">
    info_file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-an-info-file" class="md-nav__link">
    Create an INFO file
  </a>
  
    <nav class="md-nav" aria-label="Create an INFO file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maintainer" class="md-nav__link">
    maintainer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privilege_config" class="md-nav__link">
    privilege_config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protocol_file" class="md-nav__link">
    protocol_file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource_config" class="md-nav__link">
    resource_config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service_config" class="md-nav__link">
    service_config
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd_user_unit" class="md-nav__link">
    systemd_user_unit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-usrlocal-linker" class="md-nav__link">
    Configure a /usr/local Linker
  </a>
  
    <nav class="md-nav" aria-label="Configure a /usr/local Linker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usr_local_linker" class="md-nav__link">
    usr_local_linker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-usrlocal-linker_1" class="md-nav__link">
    Configure a /usr/local Linker
  </a>
  
    <nav class="md-nav" aria-label="Configure a /usr/local Linker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#confirm_binary_matches_platform" class="md-nav__link">
    confirm_binary_matches_platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker_compose" class="md-nav__link">
    docker_compose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-a-single-docker-project-a-docker-compose" class="md-nav__link">
    Configure a single Docker Project (a docker-compose)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spk_component" class="md-nav__link">
    spk_component
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Docs</h1>

<!-- Generated with Stardoc: http://skydoc.bazel.build -->

<h2 id="rules">Rules</h2>
<ul>
<li><a href="#data_share">data_share</a></li>
<li><a href="#docker_project">docker_project</a></li>
<li><a href="#image">image</a></li>
<li><a href="#images">images</a></li>
<li><a href="#info_file">info_file</a></li>
<li><a href="#maintainer">maintainer</a></li>
<li><a href="#privilege_config">privilege_config</a></li>
<li><a href="#protocol_file">protocol_file</a></li>
<li><a href="#resource_config">resource_config</a></li>
<li><a href="#service_config">service_config</a></li>
<li><a href="#systemd_user_unit">systemd_user_unit</a></li>
<li><a href="#usr_local_linker">usr_local_linker</a></li>
</ul>
<h2 id="functions">Functions</h2>
<ul>
<li><a href="#confirm_binary_matches_platform">confirm_binary_matches_platform</a></li>
<li><a href="#docker_compose">docker_compose</a></li>
<li><a href="#spk_component">spk_component</a></li>
</ul>
<p><a id="data_share"></a></p>
<h2 id="data_share">data_share</h2>
<pre>
load("@rules_synology//:defs.bzl", "data_share")

data_share(<a href="#data_share-name">name</a>, <a href="#data_share-permissions">permissions</a>, <a href="#data_share-sharename">sharename</a>)
</pre>

<p>A function to define a data-share config that will be copied to the resource of the SPK.</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="data_share-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="data_share-permissions"></a>permissions</td>
<td align="left">Permissions on the share. as a dict: {user}:{ro|rw}, {user}:{ro|rw}</td>
<td align="left"><a href="https://bazel.build/rules/lib/dict">Dictionary: String -&gt; String</a></td>
<td align="left">optional</td>
<td align="left"><code>{}</code></td>
</tr>
<tr>
<td align="left"><a id="data_share-sharename"></a>sharename</td>
<td align="left">Name of the share; if not given, the rule name will be used.</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
</tbody>
</table>
<p><a id="docker_project"></a></p>
<h2 id="docker_project">docker_project</h2>
<pre>
load("@rules_synology//:defs.bzl", "docker_project")

docker_project(<a href="#docker_project-name">name</a>, <a href="#docker_project-preload_image">preload_image</a>, <a href="#docker_project-projects">projects</a>)
</pre>

<h2 id="configure-a-collection-of-docker-projects">Configure a collection of Docker Projects</h2>
<p>The Docker Project is a <a href="../glossary/#worker">Worker</a> that carries one or more docker-compose
definitions into a Synology NAS, and can be used to turn-up the project defined in the compose
files.</p>
<p>Each project's name and compose file are represented as a <code>docker_compose()</code> target; these targets
are collected in an list <code>projects</code> in a <code>docker_project()</code> target.</p>
<p>For example:</p>
<p>(<code>BUILD</code> file)</p>
<pre><code>docker_compose(
    name = &quot;nginx&quot;
    compose = &quot;:dc.yaml&quot;,
)

docker_compose(
    name = &quot;cryptobot&quot;
    compose = &quot;:some_other_compose.yaml&quot;,
)

docker_project(
    name = &quot;green_stack&quot;,
    projects = [ &quot;:nginx&quot;, &quot;cryptobot&quot; ]
)
</code></pre>
<p>References:</p>
<ul>
<li><a href="https://help.synology.com/developer-guide/resource_acquisition/docker-project.html">Synology: Docker Project</a></li>
</ul>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="docker_project-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="docker_project-preload_image"></a>preload_image</td>
<td align="left">OCI/Docker image to preload at install of the SPK</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="docker_project-projects"></a>projects</td>
<td align="left">List of docker_compose() targets to bundle to this project</td>
<td align="left"><a href="https://bazel.build/concepts/labels">List of labels</a></td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
</tbody>
</table>
<p><a id="image"></a></p>
<h2 id="image">image</h2>
<pre>
load("@rules_synology//:defs.bzl", "image")

image(<a href="#image-name">name</a>, <a href="#image-src">src</a>, <a href="#image-image">image</a>, <a href="#image-size">size</a>, <a href="#image-verbose">verbose</a>)
</pre>

<p>Create a single resized image from the src image.</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="image-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="image-src"></a>src</td>
<td align="left">Initial source image to convert to desired size.</td>
<td align="left"><a href="https://bazel.build/concepts/labels">Label</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="image-image"></a>image</td>
<td align="left">name of target image file.  The name should end with a suffix that determines the resulting format: .png, .jpg, .PNG, etc.</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="image-size"></a>size</td>
<td align="left">size (length of square bounding box) to convert src to.</td>
<td align="left">Integer</td>
<td align="left">optional</td>
<td align="left"><code>256</code></td>
</tr>
<tr>
<td align="left"><a id="image-verbose"></a>verbose</td>
<td align="left">Verbosity can enable some debug messages from //tools:resize that can help resolve errors.</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>False</code></td>
</tr>
</tbody>
</table>
<p><a id="images"></a></p>
<h2 id="images">images</h2>
<pre>
load("@rules_synology//:defs.bzl", "images")

images(<a href="#images-name">name</a>, <a href="#images-src">src</a>, <a href="#images-images_template">images_template</a>, <a href="#images-sizes">sizes</a>, <a href="#images-verbose">verbose</a>)
</pre>

<p>Create a filegroup of resized images: 16x16, 24x24, etc</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="images-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="images-src"></a>src</td>
<td align="left">Initial source image to convert to various sizes.</td>
<td align="left"><a href="https://bazel.build/concepts/labels">Label</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="images-images_template"></a>images_template</td>
<td align="left">template for output files: use a string with a single {} that will be replaced with the size.  The template should end with a suffix that determines the resulting format: .png, .jpg, .PNG, etc.  Note that Synology SPK packaging requires files of the form PACKAGE_ICON_<size>.PNG so changing this should entail converting the result back however desired for the payload of the SPK.</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="images-sizes"></a>sizes</td>
<td align="left">sizes to convert: use a list of ints, each of which is a desired size of a square bounding box.</td>
<td align="left">List of integers</td>
<td align="left">optional</td>
<td align="left"><code>[16, 24, 32, 48, 64, 72, 90, 120, 256]</code></td>
</tr>
<tr>
<td align="left"><a id="images-verbose"></a>verbose</td>
<td align="left">Verbosity can enable some debug messages from //tools:resize that can help resolve errors.</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>False</code></td>
</tr>
</tbody>
</table>
<p><a id="info_file"></a></p>
<h2 id="info_file">info_file</h2>
<pre>
load("@rules_synology//:defs.bzl", "info_file")

info_file(<a href="#info_file-name">name</a>, <a href="#info_file-out">out</a>, <a href="#info_file-arch_strings">arch_strings</a>, <a href="#info_file-beta">beta</a>, <a href="#info_file-ctl_stop">ctl_stop</a>, <a href="#info_file-description">description</a>, <a href="#info_file-displayname">displayname</a>, <a href="#info_file-dsmappname">dsmappname</a>, <a href="#info_file-dsmapppage">dsmapppage</a>,
          <a href="#info_file-dsmuidir">dsmuidir</a>, <a href="#info_file-maintainer">maintainer</a>, <a href="#info_file-os_max_ver">os_max_ver</a>, <a href="#info_file-os_min_ver">os_min_ver</a>, <a href="#info_file-package_name">package_name</a>, <a href="#info_file-package_version">package_version</a>, <a href="#info_file-silent_install">silent_install</a>,
          <a href="#info_file-silent_uninstall">silent_uninstall</a>, <a href="#info_file-silent_upgrade">silent_upgrade</a>, <a href="#info_file-support_conf_folder">support_conf_folder</a>, <a href="#info_file-validation_softfail">validation_softfail</a>)
</pre>

<h2 id="create-an-info-file">Create an INFO file</h2>
<p>The INFO file is the simple metadata k/v dict of the SPK: a number of <code>key=value</code> pairs that define
attributes of the package.</p>
<p>This file is needed to inform the Synology NAS of the name and unique ID of the package, quote
maintainers and distributors, and indicate architecture and OS constraints to install.  I
personally expect that the simple format of this file allows the UI to show install dialogs with
minimal complexity.</p>
<p>Likely the reader will notice that the <code>maintainer()</code> block collects more information than it needs
to for the <code>INFO</code> file: the additional URL is optional, but can help track down a maintainer if a
user or collaborator needs to find them.  This is not necessarily intended to be the upstream
URL(s) of a project (ie github pages, docker URLs,etc) but is intended to be a valid URL that can
help precisely identify where the preferred path to find that maintainer.</p>
<p>This implementation mimics the defaults from Synology's documentation so that the bare minimum
attributes can be provided to unblock immediate progress.</p>
<h3 id="examples">Examples</h3>
<p>(<code>BUILD</code> file)</p>
<pre><code>load(&quot;@//:defs.bzl&quot;, &quot;info_file&quot;, &quot;maintainer&quot;)

maintainer(
    name = &quot;chickenandpork&quot;,
    maintainer_name = &quot;Allan Clark&quot;,
    maintainer_url = &quot;http://linkedin.com/in/goldfish&quot;,
    visibility = [&quot;//visibility:public&quot;],
)

info_file(
    name = &quot;floppydog_info&quot;,
    package_name = &quot;FloppyDog&quot;,
    description = &quot;Provides the FloppyDog set of CLI tools for Great Justice&quot;,
    maintainer = &quot;:chickenandpork&quot;,
    os_min_ver = &quot;7.0-1&quot;,  # correct-format=[^\d+(\.\d+){1,2}(-\d+){1,2}$]
    package_version = &quot;1.0.0-1&quot;,
)
</code></pre>
<p>The <code>INFO</code> file generated by this looks similar to:</p>
<pre><code>package=&quot;FloppyDog&quot;
version=&quot;1.0.0-1&quot;
os_min_ver=&quot;7.0-1&quot;
description=&quot;Provides the FloppyDog set of CLI tools for Great Justice&quot;
maintainer=&quot;Allan Clark&quot;
arch=&quot;noarch&quot;
ctl_stop=&quot;yes&quot;
startable=&quot;yes&quot;
thirdparty=&quot;yes&quot;
</code></pre>
<p><code>info_file()</code> uses <a href="./#maintainer">maintainer()</a> to carry information about the package's
maintainer: referring to a maintainer by target ID allows greatest re-use of a DRY data element,
and should allow the author to associate a maintainer globally maintained in a dependency resource:</p>
<p>(<code>MODULE.bazel</code>)</p>
<pre><code>bazel_dep(name = &quot;firehydrant_stuff&quot;, version = &quot;1.2.3&quot;)
</code></pre>
<p>(<code>BUILD.bazel</code>)</p>
<pre><code>info_file(
    name = &quot;firehydrant_info&quot;,
    package_name = &quot;FireHydrant&quot;,
    description = &quot;A great Incident-Management resource made by SREs for SREs&quot;,
    maintainer = &quot;@firehydrant_stuff//maint:robertross&quot;,
    os_min_ver = &quot;7.0-1&quot;,  # correct-format=[^\d+(\.\d+){1,2}(-\d+){1,2}$]
    package_version = &quot;1.0.0-1&quot;,
)
</code></pre>
<p>Ref:
* <a href="https://help.synology.com/developer-guide/synology_package/INFO.html">Synology: INFO</a></p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="info_file-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="info_file-out"></a>out</td>
<td align="left">Name of the Info file, if INFO is not preferred (changing this is not recommended).</td>
<td align="left"><a href="https://bazel.build/concepts/labels">Label</a>; <a href="https://bazel.build/reference/be/common-definitions#configurable-attributes">nonconfigurable</a></td>
<td align="left">optional</td>
<td align="left"><code>None</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-arch_strings"></a>arch_strings</td>
<td align="left">array of architectures (strings): [ "alpine", ...] (default: ["noarch"]).</td>
<td align="left">List of strings</td>
<td align="left">optional</td>
<td align="left"><code>["noarch"]</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-beta"></a>beta</td>
<td align="left">Mark version as Beta: Package Center will show the Beta marker (may allow filtering?)</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>False</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-ctl_stop"></a>ctl_stop</td>
<td align="left">Indicates (boolean) whether there is a start-stop-script and the SPK can be started or stopped (previously: startable).</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>True</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-description"></a>description</td>
<td align="left">Brief description of the package: copy-paste from the upstream if permissible.  Although this is permitted be a looooong single-line string, it does display on the UIs to install a package, so brevity is still encouraged.</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="info_file-displayname"></a>displayname</td>
<td align="left">Human-readable name of the package, should resemble external package name.  If blank, package_name is used in Synology UI.</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-dsmappname"></a>dsmappname</td>
<td align="left">Unique identifiers for App in DSM: SYNO.SDS.{name}: ['SYNO.SDS.Music', 'SYNO.SDS.Albums'].</td>
<td align="left">List of strings</td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-dsmapppage"></a>dsmapppage</td>
<td align="left">Application page to open when package 'open' button clicked.  Seems that it should be prefixed with one of the dsmappname values: SYNO.SDS.Music.Playlists.</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-dsmuidir"></a>dsmuidir</td>
<td align="left">{[linkname:]subdir}: Subdir in the Package.tgz that contains the DSM UI config and content; this will get softlinked as /usr/syno/synoman/webman/3rdparty/{linkname} -&gt; /var/packages/{package name}/target/{subdir}.  {linkname} defaults to {package_name}.  Multiple values may be given, space-separated: 'MyLinkName1:ui/app1 MyLinkName2:ui/app2'.</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-maintainer"></a>maintainer</td>
<td align="left">Maintainer of the build logic for the component (primary if multiple, a person)</td>
<td align="left"><a href="https://bazel.build/concepts/labels">Label</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="info_file-os_max_ver"></a>os_max_ver</td>
<td align="left">Latest version of DSM that can install the package; ie "DSM 7.1.1-42962".  " + "There seems to be no handling of the extended hard-to-parse suffixes used by " + "Synology such as "DSM 7.1.1-42962 Update 6".</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-os_min_ver"></a>os_min_ver</td>
<td align="left">Earliest version of DSM that can install the package; ie "DSM 7.1.1-42962".  " + "There seems to be no handling of the extended hard-to-parse suffixes used by " + "Synology such as "DSM 7.1.1-42962 Update 6".</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="info_file-package_name"></a>package_name</td>
<td align="left">Name of the package, unique within Synology SPKs, hopefully resembles external package name</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="info_file-package_version"></a>package_version</td>
<td align="left">Version of the package; although I recommend semver-ish X.Y.Z-BUILDNUM, Synology describes as being any string of numbers separated by periods, dash, or underscore, but will later fail anything outside the pattern of (0-9]+.){1-5}[-[0-9]+] (essentially 1-5 dot-separated digits with an optional hyphen and number of up to 5 digits: 1.2.3.4.5-56789)</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="info_file-silent_install"></a>silent_install</td>
<td align="left">If set to 'True', your package is allowed to be installed without the package wizard in the background.</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>False</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-silent_uninstall"></a>silent_uninstall</td>
<td align="left">If set to 'True', your package is allowed to be uninstalled without the package wizard in the background.</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>False</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-silent_upgrade"></a>silent_upgrade</td>
<td align="left">If set to 'True', your package is allowed to be upgraded without the package wizard in the background.</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>False</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-support_conf_folder"></a>support_conf_folder</td>
<td align="left">Was required to indicate that special configs in conf folder would be used.  Unnecessary since DSM-6.0 and deprecated.</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>True</code></td>
</tr>
<tr>
<td align="left"><a id="info_file-validation_softfail"></a>validation_softfail</td>
<td align="left">Redirects fatal validation failures into either debug messages or ignored/unprinted in case of inaccuracy in any validation step, or workarounds, or unittesting.  Choice of ['fail', 'message', 'ignored'].  This should likely remain the default value.</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>"fail"</code></td>
</tr>
</tbody>
</table>
<p><a id="maintainer"></a></p>
<h2 id="maintainer">maintainer</h2>
<pre>
load("@rules_synology//:defs.bzl", "maintainer")

maintainer(<a href="#maintainer-name">name</a>, <a href="#maintainer-maintainer_name">maintainer_name</a>, <a href="#maintainer-maintainer_url">maintainer_url</a>)
</pre>

<p>A simple wrapper for re-use and typing, this produces a Maintainer that can be used as an attribute to targets they maintain.</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="maintainer-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="maintainer-maintainer_name"></a>maintainer_name</td>
<td align="left">-</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="maintainer-maintainer_url"></a>maintainer_url</td>
<td align="left">-</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
</tbody>
</table>
<p><a id="privilege_config"></a></p>
<h2 id="privilege_config">privilege_config</h2>
<pre>
load("@rules_synology//:defs.bzl", "privilege_config")

privilege_config(<a href="#privilege_config-name">name</a>, <a href="#privilege_config-out">out</a>, <a href="#privilege_config-groupname">groupname</a>, <a href="#privilege_config-run_as_package">run_as_package</a>, <a href="#privilege_config-run_as_root">run_as_root</a>, <a href="#privilege_config-username">username</a>)
</pre>

<p>A function (currently stubbed) to define a privilege configuration (conf/privilege) configuring packages installed in Synology.</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="privilege_config-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="privilege_config-out"></a>out</td>
<td align="left">-</td>
<td align="left"><a href="https://bazel.build/concepts/labels">Label</a>; <a href="https://bazel.build/reference/be/common-definitions#configurable-attributes">nonconfigurable</a></td>
<td align="left">optional</td>
<td align="left"><code>None</code></td>
</tr>
<tr>
<td align="left"><a id="privilege_config-groupname"></a>groupname</td>
<td align="left">posix/unix groupname in which the app-specific user is added</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>"rules_synology"</code></td>
</tr>
<tr>
<td align="left"><a id="privilege_config-run_as_package"></a>run_as_package</td>
<td align="left">list of apps/services that sound run-as the given username</td>
<td align="left">List of strings</td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
<tr>
<td align="left"><a id="privilege_config-run_as_root"></a>run_as_root</td>
<td align="left">list of apps/services that sound run-as root</td>
<td align="left">List of strings</td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
<tr>
<td align="left"><a id="privilege_config-username"></a>username</td>
<td align="left">app-specific posix/unix username under which the app/service runs</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><a id="protocol_file"></a></p>
<h2 id="protocol_file">protocol_file</h2>
<pre>
load("@rules_synology//:defs.bzl", "protocol_file")

protocol_file(<a href="#protocol_file-name">name</a>, <a href="#protocol_file-out">out</a>, <a href="#protocol_file-package_name">package_name</a>, <a href="#protocol_file-service_config">service_config</a>)
</pre>

<p>The Protocol file is used as a wrapper/collector of service_configs: a building-block to generate the actual file as a buildable object for use in a Port Config resource.  Format is an INI file, as discussed in the DSM_Developer_Guide_7_enu.pdf, section "Port" on p 128 in my copy (search for "Configure Format Template").  Effectively, it builds the file that is pointed-to by a port-config.protocol-file entry in a resource JSON file.</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="protocol_file-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="protocol_file-out"></a>out</td>
<td align="left">-</td>
<td align="left"><a href="https://bazel.build/concepts/labels">Label</a>; <a href="https://bazel.build/reference/be/common-definitions#configurable-attributes">nonconfigurable</a></td>
<td align="left">optional</td>
<td align="left"><code>None</code></td>
</tr>
<tr>
<td align="left"><a id="protocol_file-package_name"></a>package_name</td>
<td align="left">-</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="protocol_file-service_config"></a>service_config</td>
<td align="left">-</td>
<td align="left"><a href="https://bazel.build/concepts/labels">List of labels</a></td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
</tbody>
</table>
<p><a id="resource_config"></a></p>
<h2 id="resource_config">resource_config</h2>
<pre>
load("@rules_synology//:defs.bzl", "resource_config")

resource_config(<a href="#resource_config-name">name</a>, <a href="#resource_config-resources">resources</a>, <a href="#resource_config-out">out</a>)
</pre>

<p>A function to define a resource configuration (conf/resource) configuring packages installed in Synology.</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="resource_config-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="resource_config-resources"></a>resources</td>
<td align="left">-</td>
<td align="left"><a href="https://bazel.build/concepts/labels">List of labels</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="resource_config-out"></a>out</td>
<td align="left">-</td>
<td align="left"><a href="https://bazel.build/concepts/labels">Label</a>; <a href="https://bazel.build/reference/be/common-definitions#configurable-attributes">nonconfigurable</a></td>
<td align="left">optional</td>
<td align="left"><code>None</code></td>
</tr>
</tbody>
</table>
<p><a id="service_config"></a></p>
<h2 id="service_config">service_config</h2>
<pre>
load("@rules_synology//:defs.bzl", "service_config")

service_config(<a href="#service_config-name">name</a>, <a href="#service_config-description">description</a>, <a href="#service_config-dst_ports">dst_ports</a>, <a href="#service_config-port_forward">port_forward</a>, <a href="#service_config-src_ports">src_ports</a>, <a href="#service_config-title">title</a>)
</pre>

<p>A function to define a service configuration (port-forward) for a package installed on Synology</p>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="service_config-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="service_config-description"></a>description</td>
<td align="left">-</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="service_config-dst_ports"></a>dst_ports</td>
<td align="left">-</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="service_config-port_forward"></a>port_forward</td>
<td align="left">-</td>
<td align="left">Boolean</td>
<td align="left">optional</td>
<td align="left"><code>True</code></td>
</tr>
<tr>
<td align="left"><a id="service_config-src_ports"></a>src_ports</td>
<td align="left">-</td>
<td align="left">String</td>
<td align="left">optional</td>
<td align="left"><code>""</code></td>
</tr>
<tr>
<td align="left"><a id="service_config-title"></a>title</td>
<td align="left">-</td>
<td align="left">String</td>
<td align="left">required</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><a id="systemd_user_unit"></a></p>
<h2 id="systemd_user_unit">systemd_user_unit</h2>
<pre>
load("@rules_synology//:defs.bzl", "systemd_user_unit")

systemd_user_unit(<a href="#systemd_user_unit-name">name</a>)
</pre>

<h2 id="configure-a-usrlocal-linker">Configure a /usr/local Linker</h2>
<p>The Systemd User Unit is a <a href="../glossary/#worker">Worker</a> that triggers the install process to make
available the systemd unit(s) in <code>conf/systemd/pkguser-&lt;name&gt;</code> into <code>home/.config/systemd/user/</code>
during postinst, removing during postuninst.  The package should then use <code>synosystemctl start</code> and
<code>synosystemctl stop</code> to control the service inside scripts (which should include the SSS script).</p>
<h3 id="example">Example</h3>
<p>This will cause a system user unit module to be copied from <code>conf/systemd/pkguser-awesomesauce</code> to
<code>home/.config/systemd/user/</code> so that the postinst step can trigger <code>synosystemctl start</code> in an SSS
script run during <code>postinst</code> stage (including the enclosing wrappers for clarity):</p>
<pre><code>load(&quot;@//:defs.bzl&quot;, &quot;resource_config&quot;, &quot;systemd_user_unit&quot;)

systemd_user_unit(
    name = &quot;systemd-awesome&quot;,
)
...
resource_config(
    name = &quot;rez&quot;,
    resources = [ ... &quot;:systemd-awesome&quot; ],
)

pkg_files(
    name = &quot;conf&quot;,
    srcs = [ ...  &quot;:rez&quot; ],
    prefix = &quot;conf&quot;,
)

pkg_tar(
    name = &quot;awesomesauce&quot;,
    srcs = [ ...  &quot;:conf&quot; ],
    ],
    extension = &quot;tar&quot;,
    package_file_name = &quot;awesomesauce.spk&quot;,
)

</code></pre>
<p>References:</p>
<ul>
<li><a href="https://help.synology.com/developer-guide/resource_acquisition/systemd_user_unit.html">Synology: Systemd User Unit</a></li>
</ul>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="systemd_user_unit-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><a id="usr_local_linker"></a></p>
<h2 id="usr_local_linker">usr_local_linker</h2>
<pre>
load("@rules_synology//:defs.bzl", "usr_local_linker")

usr_local_linker(<a href="#usr_local_linker-name">name</a>, <a href="#usr_local_linker-bin">bin</a>, <a href="#usr_local_linker-etc">etc</a>, <a href="#usr_local_linker-lib">lib</a>)
</pre>

<h2 id="configure-a-usrlocal-linker_1">Configure a /usr/local Linker</h2>
<p>The /usr/local linker is a <a href="../glossary/#worker">Worker</a> that softlinks payload binaries, libraries,
and config files to bin, lib, and etc subdirectories in /usr/local on package start and removes on
package stop.  If the link or file pre-exists, /usr/local worker will unlink() those files,
effectively overwriting.  Any failure to pre-delete or create a link results in the process
failing, triggering any rollback.</p>
<h3 id="example_1">Example</h3>
<p>This will cause a softlink to be created in <code>/usr/local/bin</code> that points to
<code>/var/packages/&lt;package&gt;/target/bin/netfilter-mods</code>:</p>
<pre><code>load(&quot;@//:defs.bzl&quot;, &quot;usr_local_linker&quot;)

usr_local_linker(
    name = &quot;softlinks&quot;,
    bin = [&quot;netfilter-mods&quot;],
)

</code></pre>
<p>There is currently no method of linking to a target with a different name: the underlying config
that Synology doesn't offer that capability.</p>
<p>References:</p>
<ul>
<li><a href="https://help.synology.com/developer-guide/resource_acquisition/usrlocal_linker.html">Synology: /usr/local linker</a></li>
</ul>
<p><strong>ATTRIBUTES</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Mandatory</th>
<th align="left">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="usr_local_linker-name"></a>name</td>
<td align="left">A unique name for this target.</td>
<td align="left"><a href="https://bazel.build/concepts/labels#target-names">Name</a></td>
<td align="left">required</td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a id="usr_local_linker-bin"></a>bin</td>
<td align="left">binary paths to softlink into /usr/local/bin</td>
<td align="left">List of strings</td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
<tr>
<td align="left"><a id="usr_local_linker-etc"></a>etc</td>
<td align="left">configfile paths to softlink into /usr/local/etc</td>
<td align="left">List of strings</td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
<tr>
<td align="left"><a id="usr_local_linker-lib"></a>lib</td>
<td align="left">library paths to softlink into /usr/local/lib</td>
<td align="left">List of strings</td>
<td align="left">optional</td>
<td align="left"><code>[]</code></td>
</tr>
</tbody>
</table>
<p><a id="confirm_binary_matches_platform"></a></p>
<h2 id="confirm_binary_matches_platform">confirm_binary_matches_platform</h2>
<pre>
load("@rules_synology//:defs.bzl", "confirm_binary_matches_platform")

confirm_binary_matches_platform(<a href="#confirm_binary_matches_platform-binary">binary</a>, <a href="#confirm_binary_matches_platform-size">size</a>)
</pre>

<p><strong>PARAMETERS</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="confirm_binary_matches_platform-binary"></a>binary</td>
<td align="left"><p align="center"> - </p></td>
<td align="left">none</td>
</tr>
<tr>
<td align="left"><a id="confirm_binary_matches_platform-size"></a>size</td>
<td align="left"><p align="center"> - </p></td>
<td align="left"><code>"small"</code></td>
</tr>
</tbody>
</table>
<p><a id="docker_compose"></a></p>
<h2 id="docker_compose">docker_compose</h2>
<pre>
load("@rules_synology//:defs.bzl", "docker_compose")

docker_compose(<a href="#docker_compose-name">name</a>, <a href="#docker_compose-compose">compose</a>, <a href="#docker_compose-project_name">project_name</a>, <a href="#docker_compose-path">path</a>, <a href="#docker_compose-debug">debug</a>)
</pre>

<h2 id="configure-a-single-docker-project-a-docker-compose">Configure a single Docker Project (a docker-compose)</h2>
<p>The Docker Project is a <a href="../glossary/#worker">Worker</a> that carries one or more docker-compose
definitions into a Synology NAS, and can be used to turn-up the project defined in the compose
files.</p>
<p>The Synology Docker Project Worker expects a name and a compose file for each project.
docker_compose() is used to provide a name/compose pair, which are then collected in a
docker_project() target:</p>
<p>(<code>BUILD</code> file)</p>
<pre><code>docker_compose(
    name = &quot;nginx&quot;
    compose = &quot;:dc.yaml&quot;,
)

docker_compose(
    name = &quot;cryptobot&quot;
    compose = &quot;:some_other_compose.yaml&quot;,
)

docker_project(
    name = &quot;green_stack&quot;,
    projects = [ &quot;:nginx&quot;, &quot;cryptobot&quot; ]
)
</code></pre>
<p>References:</p>
<ul>
<li><a href="https://help.synology.com/developer-guide/resource_acquisition/docker-project.html">Synology: Docker Project</a></li>
</ul>
<p><strong>PARAMETERS</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="docker_compose-name"></a>name</td>
<td align="left"><p align="center"> - </p></td>
<td align="left">none</td>
</tr>
<tr>
<td align="left"><a id="docker_compose-compose"></a>compose</td>
<td align="left"><p align="center"> - </p></td>
<td align="left">none</td>
</tr>
<tr>
<td align="left"><a id="docker_compose-project_name"></a>project_name</td>
<td align="left"><p align="center"> - </p></td>
<td align="left"><code>None</code></td>
</tr>
<tr>
<td align="left"><a id="docker_compose-path"></a>path</td>
<td align="left"><p align="center"> - </p></td>
<td align="left"><code>None</code></td>
</tr>
<tr>
<td align="left"><a id="docker_compose-debug"></a>debug</td>
<td align="left"><p align="center"> - </p></td>
<td align="left"><code>False</code></td>
</tr>
</tbody>
</table>
<p><a id="spk_component"></a></p>
<h2 id="spk_component">spk_component</h2>
<pre>
load("@rules_synology//:defs.bzl", "spk_component")

spk_component(<a href="#spk_component-name">name</a>, <a href="#spk_component-spk">spk</a>, <a href="#spk_component-filename">filename</a>)
</pre>

<p>Pull a member component from the SPK archive for further testing</p>
<p>spk_component pulls a component from the SPK file by passing the filename to an unpack; the result should be usable to confirm that the SPK packed up what was expected.</p>
<p><strong>PARAMETERS</strong></p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a id="spk_component-name"></a>name</td>
<td align="left"><p align="center"> - </p></td>
<td align="left">none</td>
</tr>
<tr>
<td align="left"><a id="spk_component-spk"></a>spk</td>
<td align="left"><p align="center"> - </p></td>
<td align="left">none</td>
</tr>
<tr>
<td align="left"><a id="spk_component-filename"></a>filename</td>
<td align="left"><p align="center"> - </p></td>
<td align="left">none</td>
</tr>
</tbody>
</table>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>